<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>파싱 도구</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 30px;
      background: #f7f7f7;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
  </style>
</head>
<body>

  <h2>서울시 확장형(온도) 원격검침 서버 수신용 데이터포맷[V1.5] NB-IoT</h2>
  <textarea id="inputData" placeholder="여기에 데이터를 붙여넣으세요 (최소 90자)"></textarea>
  <br />
  <button onclick="parseData()">파싱하기</button>

  <table id="resultTable">
    <thead>
      <tr><th>데이터 키</th><th>값(샘플)</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  const fieldMap = [
    [2, 1, "header"],
    [2, 3, "length"],
    [2, 5, "type"],
    [16, 7, "imei"],
    [16, 23, "imsi"],
    [2, 39, "rssi"],
    [2, 41, "ber"],
    [4, 43, "cid"],
    [4, 47, "rsrp"],
    [4, 51, "rsrq"],
    [4, 55, "snr"],
    [10, 59, "devNo"],
    [4, 69, "devFw"],
    [2, 73, "devVolt"],
    [8, 75, "meterNo"],
    [2, 83, "meterType"],
    [2, 85, "meterCaliber"],
    [2, 87, "meterStatus"],
    [2, 89, "msrCycle"],
    [2, 91, "msrReport"],
    [2, 93, "year"],
    [2, 95, "month"],
    [2, 97, "day"],
    [2, 99, "hour"],
    [2, 101, "minute"],
    [2, 103, "second"],
    [2, 105, "msrCycle"],
    [2, 107, "msrCnt"],
    [2, 109, "msrStdIdx"],
    [8, 111, "msrStdValue"],
    [4, 119, "msrOffset 0"],
    [4, 123, "tempValue 0"],
    [4, 127, "msrOffset 1"],
    [4, 131, "tempValue 1"],
    [4, 135, "msrOffset 2"],
    [4, 139, "tempValue 2"],
    [4, 143, "msrOffset 3"],
    [4, 147, "tempValue 3"],
    [4, 151, "msrOffset 4"],
    [4, 155, "tempValue 4"],
    [4, 159, "msrOffset 5"],
    [4, 163, "tempValue 5"],
    [4, 167, "msrOffset 6"],
    [4, 171, "tempValue 6"],
    [4, 175, "msrOffset 7"],
    [4, 179, "tempValue 7"],
    [4, 183, "msrOffset 8"],
    [4, 187, "tempValue 8"],
    [4, 191, "msrOffset 9"],
    [4, 195, "tempValue 9"],
    [4, 199, "msrOffset 10"],
    [4, 203, "tempValue 10"],
    [4, 207, "msrOffset 11"],
    [4, 211, "tempValue 11"],
    [4, 215, "msrOffset 12"],
    [4, 219, "tempValue 12"],
    [4, 223, "msrOffset 13"],
    [4, 227, "tempValue 13"],
    [4, 231, "msrOffset 14"],
    [4, 235, "tempValue 14"],
    [4, 239, "msrOffset 15"],
    [4, 243, "tempValue 15"],
    [4, 247, "msrOffset 16"],
    [4, 251, "tempValue 16"],
    [4, 255, "msrOffset 17"],
    [4, 259, "tempValue 17"],
    [4, 263, "msrOffset 18"],
    [4, 267, "tempValue 18"],
    [4, 271, "msrOffset 19"],
    [4, 275, "tempValue 19"],
    [2, 279, "checksum"]
  ];

  function parseData() {
    const data = document.getElementById("inputData").value.trim();
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    if (data.length < 90) {
      alert("데이터는 최소 90자 이상이어야 합니다.");
      return;
    }

    fieldMap.forEach(([length, start, fieldName]) => {
      const startIdx = start - 1;
      const endIdx = startIdx + length;
      const rawValue = data.slice(startIdx, endIdx);

      let displayValue = rawValue;

      // msrOffset인 경우 HEX → DEX 변환
      if (fieldName.startsWith("rssi") ||
          fieldName.startsWith("cid") ||
          fieldName.startsWith("rsrp") ||
          fieldName.startsWith("rsrq") ||
          fieldName.startsWith("snr") ||
          fieldName.startsWith("devVolt") ||
          fieldName.startsWith("year") ||
          fieldName.startsWith("month") ||
          fieldName.startsWith("day") ||
          fieldName.startsWith("hour") ||
          fieldName.startsWith("minute") ||
          fieldName.startsWith("second") ||
          fieldName.startsWith("msrStdValue 0") ||
          fieldName.startsWith("msrOffset 0") ||
          fieldName.startsWith("tempValue 0") ||
          fieldName.startsWith("msrStdValue 1") ||
          fieldName.startsWith("msrOffset 1") ||
          fieldName.startsWith("tempValue 1")) 
          {
            displayValue = parseInt(rawValue, 16).toString();
          }
          
      const row = document.createElement("tr");
      row.innerHTML = `<td>${fieldName}</td><td>${displayValue}</td>`;
      tbody.appendChild(row);
    });

  }
</script>

</body>
</html>